#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ç¾¤æ˜Ÿï¼ˆStellarisï¼‰å¸å›½ç¼–å¹´å²ç”Ÿæˆå™¨

è¯¥è„šæœ¬èƒ½å¤Ÿè§£æç¾¤æ˜Ÿæ¸¸æˆå­˜æ¡£æ–‡ä»¶ï¼Œå¹¶æ ¹æ®ç©å®¶å¸å›½çš„æ—¶é—´çº¿äº‹ä»¶
è‡ªåŠ¨ç”Ÿæˆä¸€éƒ¨å®Œæ•´çš„å¸å›½ç¼–å¹´å²ï¼ŒåŒ…æ‹¬åŠ¨æ€ç”Ÿæˆçš„AIå¸å›½è®¾å®šã€‚

ä½œè€…: luyu14039
æ—¥æœŸ: 2025å¹´9æœˆ18æ—¥
ç‰ˆæœ¬: v0.03
"""

import re
import json
import os
import sys
import random
from datetime import datetime
from typing import Dict, List, Tuple, Optional, Any
from dataclasses import dataclass


@dataclass
class TimelineEvent:
    """æ—¶é—´çº¿äº‹ä»¶æ•°æ®ç»“æ„"""
    date: str
    definition: str
    data: Dict[str, Any]
    raw_text: str


@dataclass
class GeneratedEntity:
    """åŠ¨æ€ç”Ÿæˆçš„å®ä½“ï¼ˆå¸å›½ã€ç§æ—ç­‰ï¼‰"""
    entity_type: str  # "empire", "species", "fallen_empire", "pre_ftl"
    name: str
    properties: Dict[str, Any]
    placeholder_id: str


class StellarisChronicleGenerator:
    """ç¾¤æ˜Ÿå¸å›½ç¼–å¹´å²ç”Ÿæˆå™¨"""
    
    def __init__(self):
        """åˆå§‹åŒ–ç”Ÿæˆå™¨"""
        print("=" * 60)
        print("ç¾¤æ˜Ÿï¼ˆStellarisï¼‰å¸å›½ç¼–å¹´å²ç”Ÿæˆå™¨ v0.03")
        print("=" * 60)
        print("âš ï¸  æœ¬é¡¹ç›®æ­£åœ¨å¼€å‘ä¸­ï¼äº‹ä»¶ä»£ç ä¸å…¨ï¼Œæ¬¢è¿è”ç³»Githubä¸»é¡µè¡¥å……åé¦ˆï¼")
        print("=" * 60)
        
        # å­˜å‚¨è§£æåçš„äº‹ä»¶
        self.timeline_events: List[TimelineEvent] = []
        
        # åŠ¨æ€ç”Ÿæˆçš„å®ä½“
        self.generated_entities: Dict[str, GeneratedEntity] = {}
        
        # å ä½ç¬¦è®¡æ•°å™¨
        self.entity_counters = {
            'empire': 0,
            'species': 0,
            'fallen_empire': 0,
            'pre_ftl': 0
        }
        
        # ç©å®¶å¸å›½åç§°ï¼ˆé»˜è®¤å€¼ï¼‰
        self.player_empire_name = "ç©å®¶å¸å›½"
        
        # é…ç½®é€‰é¡¹
        self.include_year_markers = True  # æ˜¯å¦åŒ…å«å¹´åº¦æ ‡è®°äº‹ä»¶
        
        # åˆå§‹åŒ–äº‹ä»¶ä»£ç æ˜ å°„è¡¨
        self.event_descriptions = self._initialize_event_descriptions()
        
        # åˆå§‹åŒ–å¸å›½ç”Ÿæˆæ•°æ®
        self.empire_generation_data = self._initialize_empire_data()
    
    def _initialize_event_descriptions(self) -> Dict[str, str]:
        """åˆå§‹åŒ–äº‹ä»¶ä»£ç åˆ°æè¿°çš„æ˜ å°„è¡¨"""
        return {
            # åŸºäºä¹‹å‰æä¾›çš„å¯¹ç…§è¡¨ï¼ŒåŠ ä¸Šå®é™…æ–‡ä»¶ä¸­çš„äº‹ä»¶å®šä¹‰
            "timeline_first_robot": "ç”µåŠ¨ä¹‹èº¯_é¦–å°æœºå™¨äºº_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]åœ¨{location}é¦–æ¬¡ç»„è£…äº†ä¸€å°æœºå™¨äºº",
            "timeline_first_precursor_discovered": "å¤ªè™šå¤è¿¹_åˆè§å…ˆé©±è€…_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡å‘ç°æ–‡æ˜å…ˆé©±",
            "timeline_first_precursor": "å¤ªè™šå¤è¿¹_åˆè§å…ˆé©±è€…_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡å‘ç°æ–‡æ˜å…ˆé©±", # å¤‡é€‰
            "timeline_first_colony": "æ–°ä¸–ç•Œ_æ®–æ°‘å…ˆç™»_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]åœ¨{colony_name}é¦–å…ˆè®¾ç«‹äº†æ®–æ°‘åœ°",
            "timeline_new_colony": "æ–°æ®–æ°‘åœ°_æ–°æ®–æ°‘åœ°_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]åœ¨{colony_name}è®¾ç«‹æ®–æ°‘åœ°",
            "timeline_elections": "é€‰ä¸¾_é€‰ä¸¾_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]ä¸¾è¡Œäº†é€‰ä¸¾",
            "timeline_first_contact": "æµ·å†…å­˜çŸ¥å·±_é¦–é‡æ™ºæ…§ç”Ÿå‘½_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–å…ˆé­é‡æ™ºæ…§ç”Ÿå‘½",
            "timeline_first_ascension_perk": "å´‡é«˜ä¹‹è·¯_é¦–ä¸ªé£å‡å¤©èµ‹_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡é€‰æ‹©é£å‡å¤©èµ‹",
            "timeline_first_espionage_operation": "è¡Œèµ°çš„ç§˜å¯†_è°æµ·åˆæ¶‰_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡æ‰§è¡Œè°æŠ¥æ´»åŠ¨",
            "timeline_first_rare_tech": "åˆ›æ–°å…ˆé”‹_é¦–ä¸ªç¨€æœ‰ç§‘æŠ€_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡ç ”ç©¶äº†ç¨€æœ‰ç§‘æŠ€",
            "timeline_first_unique_system": "åƒè½½ä¸€è§_é¦–å¾—ç‹¬ç‰¹æ˜Ÿç³»_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]æ§åˆ¶äº†ä¸€ä¸ªç‹¬ç‰¹çš„{system_name}æ’æ˜Ÿç³»",
            "timeline_first_max_level_leader_cap": "ä¸¾è´¤çº³è¨€_å†…é˜æ‰©å®¹_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]å°†å†…é˜æ‰©å®¹åˆ°ä¸Šé™",
            "timeline_first_gateway": "ç¾¤æ˜Ÿä¹‹é—¨_é¦–è§æ˜Ÿé—¨_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]åœ¨{system_name}æ’æ˜Ÿç³»é¦–æ¬¡å‘ç°äº†ä¸€åº§è¿œå¤æ˜Ÿé—¨",
            "timeline_first_species_modification": "è®¾è®¡è¿›åŒ–_é¦–åº¦ç‰©ç§ä¿®é¥°_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡ä¿®é¥°äº†ç‰©ç§",
            "timeline_first_relic": "å²æœˆé—ç _é¦–è·é—ç_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡å–å¾—é—ç",
            "timeline_galactic_community_formed": "æ–°ç§©åº_æ˜Ÿæµ·å…±åŒä½“_æ˜Ÿç³»äº‹ä»¶_æ˜Ÿç³»çš„å„å›½æ±‡èšä¸€å ‚å½¢æˆä¸€ä¸ªæ”¿æ²»å®ä½“ã€‚æ˜Ÿæµ·å…±åŒä½“å»ºç«‹äº†ï¼Œè¿™åº§é›†å¤–äº¤ã€è¾©è®ºå’ŒæƒåŠ›æ–—äº‰ä¸ºä¸€ä½“çš„è®ºå›å°†å¡‘é€ ç¾¤æ˜Ÿçš„æœªæ¥ã€‚å®ƒçš„å®é™…ä½œç”¨è¿˜æœ‰å¾…è§‚å¯Ÿã€‚",
            "timeline_first_storm": "å†æ— å®æ¸¯_é¦–é‡é£æš´_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]åœ¨å…¶å¢ƒå†…çš„{system_name}æ’æ˜Ÿç³»é¦–æ¬¡é­é‡ç²’å­é£æš´",
            "timeline_first_shroud": "ç©ºé—´è£‚éš™_åˆæ¢æ˜Ÿç•Œè£‚éš™_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡æ¢ç´¢æ˜Ÿç•Œè£‚éš™",
            "timeline_first_destiny_trait": "å“è¶Šä¹‹è¯_é¦–è·å‘½å®šç‰¹è´¨_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]çš„{leader_name}é¦–æ¬¡è·å¾—å‘½å®šç‰¹è´¨",
            "timeline_synthetic_evolution": "åˆæˆåŒ–_ç¤¾ä¼šåˆæˆåŒ–_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]å®Œæˆäº†åˆæˆé£å‡",
            "timeline_first_terraforming": "æ˜Ÿçƒæ–°ç”Ÿ_åˆæ¢ç¯å¢ƒæ”¹é€ _é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡ç¯å¢ƒæ”¹é€ äº†{planet_name}",
            "timeline_first_war_declared": "æˆ’æ’¼æ˜Ÿé™…_é¦–æˆ˜æ‰“å“_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–å…ˆå‘[å¸å›½{target_empire}]å®£æˆ˜",
            "timeline_leviathan_encountered": "çœ è€…å°†é†’_å‘ç°æ˜Ÿç¥å…½_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]é­é‡äº†{leviathan_name}",
            "timeline_first_war_won": "æ˜Ÿå…‰å‡¯æ—‹_é¦–è·å‡¯æ—‹_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡å‡»è´¥äº†[å¸å›½{defeated_empire}]",
            "timeline_first_subject": "å¿ è¯šä¹‹é“¾_ç¬¬ä¸€é™„å±å›½_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]æ”¶[å¸å›½{subject_empire}]ä¸ºé™„åº¸",
            "timeline_first_wormhole": "å®‡å®™å¯†é“_åˆæ¢è™«æ´_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡åœ¨{system_name}æ’æ˜Ÿç³»å‘ç°è™«æ´",
            "timeline_fallen_empire_encountered": "å¤±è½å¸å›½_å¤±è½å¸å›½_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]é­é‡äº†[å •è½å¸å›½{fallen_empire}]",
            "timeline_great_khan": "è„±ç¼°æ±—å›½_å¤§å¯æ±—_å±æœºäº‹ä»¶_ä¸€ä½æ–°èµ·çš„å†›é˜€å°†æ”¯ç¦»ç ´ç¢çš„æ å¤ºè€…éƒ¨è½è”åˆèµ·æ¥ï¼Œé”»é€ æˆä¸€ä¸ªæ— æƒ…çš„æ±—å›½ã€‚å¤§æ±—å¸¦ç€ç­‰ç¦»å­ä¸ç¢³çº¤ç»´æ¨ªæ‰«æ˜Ÿç³»ï¼Œæ¨ç¿»å¸å›½ï¼Œå¥´å½¹æ˜Ÿçƒã€‚æ— æ³•æ— å¤©çš„æ å¤ºè€…ç°åœ¨ä»¥ä¸€ä¸ªå¯æ€•çš„ç›®æ ‡å‡èšä¸€ç¾¤ï¼Œèˆ°é˜Ÿåœ¨ä»–ä»¬çš„åŠ›é‡é¢å‰ä¸€æ”¯åˆä¸€æ”¯å´©æºƒã€‚æ å¤ºçš„æ—¶ä»£ç»“æŸï¼Œå¾æœçš„çºªå…ƒå¼€å§‹ã€‚",
            "timeline_first_repeatable_tech": "å­¦æµ·æ— æ¶¯_é¦–ä¸ªå¾ªç¯ç§‘æŠ€_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡ç ”ç©¶äº†å¾ªç¯ç§‘æŠ€",
            "timeline_first_100k_fleet": "æ— æ•Œä¸»å®°_é¦–æ”¯100Kèˆ°é˜Ÿ_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡ç»„å»ºäº†å‰æ‰€æœªæœ‰çš„å¼ºå¤§èˆ°é˜Ÿ, {fleet_name}",
            "timeline_first_juggernaut": "é¦–èˆ°ä¸‹æ°´_é¦–èˆ°ä¸‹æ°´_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡å»ºé€ äº†, {ship_name}",
            "timeline_war_declared": "å®£æˆ˜_å®£æˆ˜_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]å‘[å¸å›½{target_empire}]å®£æˆ˜",
            "timeline_capital_changed": "æ‹”åœ°è€Œèµ·_è¿éƒ½_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]è¿éƒ½è‡³{new_capital}",
            "timeline_first_terraform": "æ”¹å¤©æ¢åœ°_é¦–æ¬¡ç¯å¢ƒæ”¹é€ _é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]è¿›è¡Œäº†ç¯å¢ƒæ”¹é€ ",
            "timeline_first_arc_site": "å©é—®å¤äºº_é¦–æ¬¡æ¢ç´¢è€ƒå¤åœ°ç‚¹_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡è¿›è¡Œäº†è€ƒå¤åœ°ç‚¹å‘æ˜",
            "timeline_galactic_community_resolution": "è®®æ¡ˆé€šè¿‡_æ˜Ÿç³»äº‹ä»¶_æ˜Ÿæµ·å…±åŒä½“å·²ç»å‘å¸ƒäº†ä¸€åˆ™å£°æ˜ã€‚ä¸€é¡¹æ–°çš„å†³è®®å³å°†é‡å¡‘æ˜Ÿé™…æ³•åˆ™ã€‚æœ‰äº›æ–‡æ˜æ¬¢æ¬£é¼“èˆï¼Œå…¶ä»–æ–‡æ˜åˆ™æ„¤æ€’ä¸å·²ï¼Œä½†æ‰€æœ‰æˆå‘˜éƒ½å¿…é¡»éµä»è¿™ä¸€è§„å®šã€‚",
            "timeline_first_vassal": "å¿ è¯šä¹‹é“¾_ç¬¬ä¸€é™„å±å›½_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]æ”¶æŸä¸ªå¸å›½ä¸ºé™„åº¸",
            "timeline_new_vassal": "å†æ·»é™„åº¸_æ–°çš„ä»†ä»_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]åˆæ”¶äº†ä¸€ä¸ªæ–°çš„é™„åº¸",
            "timeline_first_astral_rift": "ç©ºé—´è£‚éš™_åˆæ¢æ˜Ÿç•Œè£‚éš™_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡ä¾¦æµ‹åˆ°å¹¶æ¢ç´¢äº†ä¸€å¤„æ˜Ÿç•Œè£‚éš™",
            "timeline_war_declared_attacker": "æˆ˜äº‰å·è§’_ä¸»åŠ¨å®£æˆ˜_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]ä½œä¸ºæ”»å‡»æ–¹ï¼Œå‘å¦ä¸€ä¸ªå¸å›½ä¸»åŠ¨å®£æˆ˜",
            "timeline_first_storm_within_borders": "è™šç©ºé£æš´_é¦–é‡é£æš´_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]åœ¨å¢ƒå†…é¦–æ¬¡é­é‡äº†å¤ªç©ºé£æš´",
            "timeline_meet_fallen_empire_discover": "æ˜”æ—¥å·¨åƒ_é­é‡å¤±è½å¸å›½_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]çš„é£èˆ¹é­é‡äº†ä¸€ä¸ªå¤è€è€Œåœæ»çš„å¤±è½å¸å›½",
            "timeline_council_max_expansion": "è®®ä¼šå…¨å¸­_å†…é˜æ‰©å®¹_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]å°†è®®ä¼šå¸­ä½æ‰©å……è‡³ä¸Šé™",
            
            # è¡¥å……äº‹ä»¶ - æ–°å¢äº‹ä»¶ä»£ç 
            "timeline_encountered_leviathan": "çœ è€…å°†é†’_å‘ç°æ˜Ÿç¥å…½_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]é­é‡äº†{leviathan_name}",
            "timeline_become_the_crisis": "æ˜Ÿæµ·å¤©ç½š_åŒ–èº«å¤©ç¾_å±æœºäº‹ä»¶_é»‘æš—å·²ç»é™ä¸´é“¶æ²³ç³»ã€‚[ç©å®¶å¸å›½]æŠ›å¼ƒäº†æ‰€æœ‰å¤–äº¤ä¼ªè£…ï¼Œå®£ç§°è‡ªå·±æ˜¯é“¶æ²³ç”Ÿå­˜çš„æœ€å¤§å¨èƒã€‚ä»–ä»¬çš„èˆ°é˜Ÿæ­£åœ¨é›†ç»“ï¼Œè€Œæƒ…æŠ¥äººå‘˜åˆ™ä½å£°ä¼ é€’ç€ä¸€é¡¹æœ€ç»ˆçš„ã€æœ«æ—¥èˆ¬çš„è®¡åˆ’ã€‚ä»–ä»¬ä¸å†ä»…ä»…æ˜¯ä¸€ä¸ªå¸å›½ï¼Œè€Œæ˜¯æ¼”å˜æˆäº†ä¸€åœºå±æœºã€‚",
            "timeline_modularity": "å…¨é¢æ¨¡ç»„_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]å®Œå…¨å˜ä¸ºæ¨¡ç»„åŒ–",
            "timeline_destroyed_leviathan": "å®ˆæŠ¤è€…ä¸å†_æ‘§æ¯æ˜Ÿç¥å…½_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]æ‘§æ¯äº†{leviathan_name}",
            "timeline_first_deficit": "è´ªå©ªä¹‹ä»·_é¦–ç°èµ¤å­—_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡å‡ºç°èµ„æºçŸ­ç¼º",
            "timeline_deficit": "èµ„æºçŸ­ç¼º_èµ„æºçŸ­ç¼º_å¸å›½äº‹ä»¶_[ç©å®¶å¸å›½]å‘ç”Ÿäº†èµ„æºçŸ­ç¼º",
            "timeline_first_war_lost": "è´¥è€…ä¹‹å°˜_åˆå°è´¥ç»©_é‡Œç¨‹ç¢‘_[ç©å®¶å¸å›½]é¦–æ¬¡è¢«[å¸å›½{defeated_empire}]å‡»è´¥",
            
            # å¹´åº¦æ ‡è®°äº‹ä»¶
            "timeline_event_year": "å¹´åº¦æ ‡è®°_{date}_æ—¶å…‰èè‹’ï¼Œ{date}å¹´æ‚„ç„¶è€Œè‡³ã€‚",
            
            # èµ·æºç›¸å…³äº‹ä»¶ - å®Œæ•´èµ·æºåˆ—è¡¨
            "timeline_origin_default": "ç¹è£ä¸€ç»Ÿ_å¸å›½èµ·æº_[ç©å®¶å¸å›½]é€šè¿‡æ–—äº‰å’Œèƒœåˆ©ï¼Œè¿™ä¸ªç¤¾ä¼šå·²ç»å®ç°äº†æ¯ä¸€ä¸ªå¹´è½»æ–‡æ˜çš„æŠ±è´Ÿï¼šä¸€ä¸ªæœ‰ç€ç»Ÿä¸€ç›®æ ‡çš„å®¶å›­ï¼Œä¸€æ¡é€šå‘ç’€ç’¨ç¹æ˜Ÿçš„é“è·¯",
            "timeline_origin_separatists": "åˆ†ç¦»ä¸»ä¹‰è€…_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜å¹¶éè¯ç”Ÿäºå…¨çƒç»Ÿä¸€ï¼Œè€Œæ˜¯ç”±ä¸€ç¾¤å¤§èƒ†çš„æ®–æ°‘è€…å»ºç«‹çš„ï¼Œä»–ä»¬åœ¨ä¸€ä¸ªå´­æ–°çš„ä¸–ç•Œä¸Šå¯»æ±‚è‡ªå·±çš„å‘½è¿",
            "timeline_origin_mechanists": "æœºæ¢°å¸ˆ_å¸å›½èµ·æº_[ç©å®¶å¸å›½]å°½ç®¡è¯¥æ–‡æ˜åœ¨ç”Ÿç‰©å±‚é¢ä»æ˜¯æœ‰æœºä½“ï¼Œä½†ä»–ä»¬æ—©å·²å¯¹è‡ªåŠ¨åŒ–çš„æœºå™¨äººåŠ³å·¥ä¹ ä»¥ä¸ºå¸¸ã€‚ä»–ä»¬å·²ç»å°†è®¸å¤šå‘å¾®ï¼ˆç”šè‡³ä¸é‚£ä¹ˆå‘å¾®ï¼‰çš„è‹¦å·®äº‹éƒ½äº¤ç»™äº†è‡ªåŠ¨åŒ–ä»†ä»",
            "timeline_origin_syncretic_evolution": "ååŒè¿›åŒ–_å¸å›½èµ·æº_[ç©å®¶å¸å›½]åœ¨ä¸€é¢—å…±äº«çš„æ¯æ˜Ÿä¸Šï¼Œä¸¤ä¸ªä¸åŒçš„ç‰©ç§å¹¶è‚©æ¼”åŒ–ï¼Œç›¸å¾—ç›Šå½°ã€‚ä¸€ä¸ªç‰©ç§å‘å±•å‡ºäº†é«˜çº§è®¤çŸ¥èƒ½åŠ›ï¼Œè€Œå¦ä¸€ä¸ªç‰©ç§åˆ™è¿›åŒ–å‡ºäº†è¶…å‡¡çš„åŠ›é‡å’Œè€åŠ›â€”â€”è¿™æ˜¯ä¸€ä¸ªå®Œç¾çš„ç»„åˆ",
            "timeline_origin_life_seeded": "ç”Ÿå‘½ä¹‹ç±½_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜åœ¨ä¸€ä½è¿œè¶…å…¶æƒ³è±¡çš„è¿œå¤ä»å–„å­˜åœ¨çš„ç›‘æŠ¤ä¸‹é€æ¸æ¼”åŒ–ï¼Œä»–ä»¬çš„æ¯æ˜Ÿæ˜¯ä¸€é¢—å®Œç¾çš„ç›–äºšæ˜Ÿçƒï¼Œè¿™æ ·çš„ç¯å¢ƒæ— ç–‘æ˜¯æ™ºæ…§ç”Ÿå‘½å‘å±•çš„æ‘‡ç¯®",
            "timeline_origin_post_apocalyptic": "åå¯ç¤ºå½•_å¸å›½èµ·æº_[ç©å®¶å¸å›½]åœ¨ä¸€åœºå°†æ¯æ˜Ÿå˜ä¸ºè¾å°„åºŸåœŸçš„ç­ä¸–æ ¸æˆ˜äº‰ä¹‹åï¼Œè¿™ä¸ªæ–‡æ˜çš„å¹¸å­˜è€…ä»¬ç»ˆäºä»åœ°ä¸‹çš„é˜²è¾å°„æ©ä½“ä¸­èµ°äº†å‡ºæ¥ï¼Œå‡†å¤‡åœ¨ç¾¤æ˜Ÿä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„ã€æ›´å…‰æ˜çš„æœªæ¥",
            "timeline_origin_remnants": "å¤å›½å­‘é—_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜çš„æ¯æ˜Ÿæ›¾æ˜¯ä¸€ä¸ªåºå¤§ã€å…ˆè¿›å¸å›½çš„é¦–éƒ½ã€‚ä½†åœ¨ä¸€åœºç¥ç§˜çš„ç¾éš¾ä¹‹åï¼Œå¸å›½åˆ†å´©ç¦»æï¼Œåªç•™ä¸‹äº†è¿™ä¸ªæ˜Ÿçƒä¸Šä¸æ–­è¡°è´¥çš„åŸå¸‚å’Œè¿™ä¸ªæ›¾ç»è‡ªè±ªçš„æ–‡æ˜çš„é—æ°‘",
            "timeline_origin_shattered_ring": "ç ´ç¢ä¹‹ç¯_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜å¹¶éåœ¨è¡Œæ˜Ÿä¸Šï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªå·¨å¤§çš„äººé€ ç¯å½¢ä¸–ç•Œçš„ä¸€éƒ¨åˆ†ä¸Šæ¼”åŒ–ã€‚å°½ç®¡ä»–ä»¬å·²ç»å¿˜è®°äº†å®ƒçš„èµ·æºï¼Œä½†ä»–ä»¬çš„ç¥–å…ˆæ¯«æ— ç–‘é—®æ›¾æ˜¯æŠ€æœ¯å¤§å¸ˆ",
            "timeline_origin_void_dwellers": "è™šç©ºå±…è€…_å¸å›½èµ·æº_[ç©å®¶å¸å›½]æ•°åä¸‡å¹´æ¥ï¼Œè¿™ä¸ªæ–‡æ˜çš„å…ˆè¾ˆä»¬ä¸€ç›´ç”Ÿæ´»åœ¨ä»–ä»¬å¤ªé˜³ç³»æ·±ç©ºçš„è½¨é“æ –æ¯åœ°é‡Œã€‚å¯¹äºä»–ä»¬è€Œè¨€ï¼Œä»–ä»¬çš„æ¯æ˜Ÿåªæ˜¯ä¸€ä¸ªè¢«é—å¿˜å·²ä¹…çš„ä¼ è¯´â€”â€”ä¸€ä¸ªä»–ä»¬ç°åœ¨å¸Œæœ›èƒ½é‡æ–°å‘ç°çš„ä¼ è¯´",
            "timeline_origin_scion": "å…ˆè¾ˆå­å¼Ÿ_å¸å›½èµ·æº_[ç©å®¶å¸å›½]å‡ºäºæŸç§åŸå› ï¼Œä¸€ä¸ªå¤è€è€Œå¼ºå¤§çš„å •è½å¸å›½å¯¹è¿™ä¸ªå¹´è½»çš„æ–‡æ˜äº§ç”Ÿäº†å…´è¶£ï¼Œå¹¶å†³å®šå°†ä»–ä»¬ç½®äºè‡ªå·±çš„ç¾½ç¿¼ä¹‹ä¸‹ã€‚è‡³äºæœªæ¥ä¼šæ€æ ·ï¼Œåªæœ‰æ—¶é—´æ‰èƒ½è¯æ˜",
            "timeline_origin_galactic_doorstep": "ç¹æ˜Ÿé—¨é˜¶_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜çš„æ¯æ˜Ÿä½äºä¸€ä¸ªç”±æœªçŸ¥å…ˆè¡Œè€…å»ºé€ çš„åºŸå¼ƒå·¨æ„â€”â€”æ˜Ÿé—¨é™„è¿‘ã€‚å°½ç®¡ç›®å‰å®ƒè¿˜å¤„äºä¼‘çœ çŠ¶æ€ï¼Œä½†è¿™ä¸ªæ–‡æ˜æ­£åœ¨åŠªåŠ›è§£å¼€å®ƒçš„ç§˜å¯†ï¼Œå¸Œæœ›å®ƒèƒ½æˆä¸ºé€šå¾€é“¶æ²³ç³»çš„æ·å¾„",
            "timeline_origin_tree_of_life": "ç”Ÿå‘½ä¹‹æ ‘_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªèœ‚å·¢æ€ç»´æ–‡æ˜ä¸ä¸€ä¸ªå¤è€çš„ç”Ÿå‘½ä¹‹æ ‘å…±ç”Ÿã€‚å®ƒæ‰æ ¹äºä»–ä»¬çš„æ¯æ˜Ÿï¼Œå¹¶ä¸å…¶æ‰€æœ‰çš„äººå£è¿›è¡Œå¿ƒçµæ„Ÿåº”è¿æ¥ï¼Œèµ‹äºˆä»–ä»¬ç”Ÿå‘½ï¼Œå¹¶åŠ é€Ÿä»–ä»¬çš„æˆé•¿",
            "timeline_origin_shoulders_of_giants": "å±¹äºå·¨äººä¹‹è‚©_å¸å›½èµ·æº_[ç©å®¶å¸å›½]åœ¨ä»–ä»¬çš„æ¯æ˜Ÿä¸Šå‘ç°äº†ä¸€ç³»åˆ—å¯ä»¥è¿½æº¯åˆ°æ•°ç™¾ä¸‡å¹´å‰çš„å¤ä»£é—è¿¹ã€‚å°½ç®¡å…¶å»ºè®¾è€…çš„èº«ä»½ä»ç„¶æ˜¯ä¸ªè°œï¼Œä½†è¿™ä¸ªæ–‡æ˜å·²ç»å­¦ä¼šäº†ç ´è¯‘ä»–ä»¬ç•™ä¸‹çš„ä¸€äº›åŸºæœ¬æ–‡æœ¬ï¼Œå¹¶æ­£å¤„äºæŠ€æœ¯é©å‘½çš„è¾¹ç¼˜",
            "timeline_origin_lithoid": "é™ä¸–ç¾æ˜Ÿ_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªå²©çŸ³ç‰©ç§å¹¶éåœ¨ä»–ä»¬çš„æ¯æ˜Ÿä¸Šæ¼”åŒ–è€Œæ¥ã€‚ä»–ä»¬ä¹˜åä¸€é¢—å·¨å¤§çš„å°è¡Œæ˜Ÿæ¥åˆ°è¿™é‡Œï¼Œåœ¨æ’å‡»ä¸­å¹¸å­˜ä¸‹æ¥ï¼Œç„¶åé€æ¸å æ®äº†ä¸»å¯¼åœ°ä½",
            "timeline_origin_common_ground": "å…±åŒå‘½è¿_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜æ˜¯é“¶æ²³è”ç›Ÿçš„åˆ›å§‹æˆå‘˜ä¹‹ä¸€ï¼Œé“¶æ²³è”ç›Ÿæ˜¯ä¸€ä¸ªæ—¨åœ¨ä¿ƒè¿›æ˜Ÿé™…åˆä½œå’Œå•†ä¸šå‘å±•çš„æ–°ç”Ÿç»„ç»‡ã€‚å¦å¤–ä¸¤ä¸ªåˆ›å§‹æˆå‘˜å›½ä¹Ÿå·²ç»å®ç°äº†è¶…å…‰é€Ÿæ—…è¡Œï¼Œå¹¶å‡†å¤‡å¥½ä¸ä»–ä»¬çš„é‚»å›½ä¸€èµ·æ¢ç´¢é“¶æ²³ç³»",
            "timeline_origin_hegemon": "ä¸€æ–¹éœ¸ä¸»_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜æ˜¯éœ¸æƒè”ç›Ÿçš„é¢†å¯¼è€…ï¼Œéœ¸æƒè”ç›Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ”¿æ²»é›†å›¢ï¼Œå¦å¤–ä¸¤ä¸ªæˆå‘˜å›½éƒ½æ›¾æ˜¯å…¶é™„åº¸ã€‚ç°åœ¨ä»–ä»¬å·²ç»éƒ½å®ç°äº†è¶…å…‰é€Ÿæ—…è¡Œï¼Œä»–ä»¬å·²ç»å‡†å¤‡å¥½åœ¨é“¶æ²³ç³»çš„èˆå°ä¸Šç»´æŠ¤ä»–ä»¬çš„ç»Ÿæ²»åœ°ä½äº†",
            "timeline_origin_doomsday": "æœ«æ—¥å°†ä¸´_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜çš„æ¯æ˜Ÿæä¸ç¨³å®šã€‚æ ¹æ®ä»–ä»¬æœ€å¯é çš„ç§‘å­¦æ¨¡å‹çš„é¢„æµ‹ï¼Œåœ¨ä»–ä»¬çš„æ–‡æ˜å¼€å§‹æ˜Ÿé™…èˆªè¡Œçš„å‡ åå¹´å†…ï¼Œå®ƒå°†è¢«ä¸€åœºç¾éš¾æ‰€åå™¬ã€‚ç”Ÿå­˜çš„å”¯ä¸€å¸Œæœ›å°±åœ¨äºç¾¤æ˜Ÿä¹‹ä¸­",
            "timeline_origin_lost_colony": "å¤±è½è¡Œæ˜Ÿ_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜çš„ç¥–å…ˆä¹˜åæ®–æ°‘èˆ¹æ¥åˆ°ä»–ä»¬çš„æ¯æ˜Ÿï¼Œä½†æ‰€æœ‰å…³äºä»–ä»¬æ¯æ˜Ÿçš„è®°å½•éƒ½å·²ä¸¢å¤±ã€‚ä¹Ÿè®¸åœ¨é“¶æ²³ç³»çš„æŸä¸ªåœ°æ–¹ï¼Œä»–ä»¬å¯ä»¥æ‰¾åˆ°ä»–ä»¬å¤±æ•£å·²ä¹…çš„åŒèƒ",
            "timeline_origin_necrophage": "é£Ÿå°¸æ–‡åŒ–_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜ç”±ä¸¤ä¸ªç‰©ç§ç»„æˆï¼Œä¸€ä¸ªæ˜¯è¢«è½¬åŒ–ä¸ºä¸»ç‰©ç§çš„æ¬¡çº§ç‰©ç§ï¼Œå¦ä¸€ä¸ªæ˜¯ä½œä¸ºæ¬¡çº§ç‰©ç§å­˜åœ¨çš„åŸç”Ÿç”Ÿç‰©ã€‚ä»–ä»¬é€šè¿‡è½¬åŒ–å…¶ä»–ç‰©ç§çš„äººå£æ¥ç¹è¡ï¼Œå°†ä»–ä»¬å¸¦å…¥è‡ªå·±ä¸æœ½çš„è¡Œåˆ—",
            "timeline_origin_clone_army": "å…‹éš†å¤§å†›_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜æ˜¯ç”±å¤ä»£ã€æŠ€æœ¯å…ˆè¿›çš„å…‹éš†æˆ˜å£«åˆ›é€ çš„ï¼Œä»–ä»¬å·²ç»åœ¨ä¸€ä¸ªè¢«é—å¿˜çš„æ—¶ä»£ä¸ºä»–ä»¬çš„ä¸»äººèµ¢å¾—äº†æ— æ•°çš„æˆ˜äº‰ã€‚ä½†ç°åœ¨ä»–ä»¬çš„ä¸»äººå·²ç»ä¸åœ¨äº†ï¼Œä»–ä»¬å¿…é¡»ä¸ºè‡ªå·±å¼€åˆ›ä¸€æ¡æ–°çš„é“è·¯",
            "timeline_origin_here_be_dragons": "ä¸é¾™å…±èˆ_å¸å›½èµ·æº_[ç©å®¶å¸å›½]ä¸€æ¡ä»¥å¤ªå·¨é¾™åœ¨ä»–ä»¬çš„æ¯æ˜Ÿä¸Šç©ºç›˜æ—‹ï¼Œä¿æŠ¤ç€å®ƒï¼Œå°±åƒä¿æŠ¤è‡ªå·±çš„å­©å­ä¸€æ ·ã€‚è¿™ä¸ªæ–‡æ˜å·²ç»å­¦ä¼šäº†ä¸å®ƒå…±å­˜ï¼Œç”šè‡³å´‡æ‹œå®ƒã€‚åªè¦å·¨é¾™è¿˜æ´»ç€ï¼Œå°±æ²¡æœ‰äººæ•¢å¨èƒä»–ä»¬çš„æ¯æ˜Ÿ",
            "timeline_origin_ocean_paradise": "æµ·æ´‹å¤©å ‚_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜åœ¨ä¸€ä¸ªè¢«å·¨å¤§æµ·æ´‹è¦†ç›–çš„æ˜Ÿçƒä¸Šæ¼”åŒ–è€Œæ¥ã€‚ä»–ä»¬çš„æ¯æ˜Ÿæ˜¯ä¸€ä¸ªæ°´ç”Ÿå¤©å ‚ï¼Œå……æ»¡äº†ç”Ÿå‘½å’Œä¸°å¯Œçš„èµ„æº",
            "timeline_origin_progenitor_hive": "å§‹ç¥–èœ‚å·¢_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªèœ‚å·¢æ€ç»´æ–‡æ˜ç”±ä¸€ä¸ªå¤è€è€Œå¼ºå¤§çš„ç¥–å…ˆèœ‚åé¢†å¯¼ï¼Œå®ƒé€šè¿‡å¿ƒçµæ„Ÿåº”ç½‘ç»œå°†å…¶æ„å¿—å¼ºåŠ ç»™å®ƒçš„å­æ°‘ã€‚åªè¦èœ‚åè¿˜æ´»ç€ï¼Œèœ‚å·¢å°±ä¼šç¹è£æ˜Œç››",
            "timeline_origin_subterranean": "åœ°åº•äºº_å¸å›½èµ·æº_[ç©å®¶å¸å›½]ç”±äºä»–ä»¬æ¯æ˜Ÿçš„è¡¨é¢ç¯å¢ƒæ¶åŠ£ï¼Œè¿™ä¸ªæ–‡æ˜çš„ç¥–å…ˆä»¬åœ¨åœ°ä¸‹å¯»æ±‚åº‡æŠ¤ã€‚ä»–ä»¬å·²ç»é€‚åº”äº†åœ°ä¸‹çš„ç”Ÿæ´»ï¼Œå¹¶å­¦ä¼šäº†åˆ©ç”¨å…¶ä¸°å¯Œçš„èµ„æº",
            "timeline_origin_star_slingshot": "å°„å‘æ˜Ÿé™…_å¸å›½èµ·æº_[ç©å®¶å¸å›½]åœ¨ä»–ä»¬çš„å¤ªé˜³ç³»ä¸­å‘ç°äº†ä¸€ä¸ªå·¨å¤§çš„é‡å­å¼¹å¼“ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±æœªçŸ¥å…ˆè¡Œè€…å»ºé€ çš„åºŸå¼ƒå·¨æ„ã€‚åœ¨å¯¹å…¶è¿›è¡Œäº†æ•°åå¹´çš„ç ”ç©¶ä¹‹åï¼Œè¿™ä¸ªæ–‡æ˜ç»ˆäºå­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨å®ƒï¼Œå¹¶å‡†å¤‡å¥½ä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦å°†è‡ªå·±å¼¹å°„åˆ°é“¶æ²³ç³»ä¸­",
            "timeline_origin_shroudwalker_apprentice": "è™šå¢ƒå¯¼å¸ˆ_å¸å›½èµ·æº_[ç©å®¶å¸å›½]ä¸€ç¾¤è¢«ç§°ä¸º\'è™šè¡Œè€…\'çš„ç¥ç§˜çµèƒ½ä¸»ä¹‰è€…å¯¹è¿™ä¸ªæ–‡æ˜äº§ç”Ÿäº†å…´è¶£ï¼Œå¹¶å†³å®šå°†ä»–ä»¬æ”¶ä¸ºå­¦å¾’ã€‚ä»–ä»¬æ‰¿è¯ºä¼šæ•™ç»™ä»–ä»¬è™šå¢ƒçš„å¥¥ç§˜ï¼Œä½†è¿™èƒŒåå¯èƒ½éšè—ç€æ›´æ·±å±‚æ¬¡çš„åŠ¨æœº",
            "timeline_origin_imperial_vassal": "å¸å›½å°é‚‘_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜æ˜¯æŸä¸ªæ›´å¼ºå¤§çš„æ˜Ÿé™…å¸å›½çš„ä¸€ä¸ªå°é™„åº¸ã€‚ä»–ä»¬å—åˆ¶äºå®—ä¸»å›½çš„æ³•å¾‹å’Œå¼‚æƒ³å¤©å¼€ï¼Œä½†ä»–ä»¬ä¹Ÿå—åˆ°å®—ä¸»å›½çš„ä¿æŠ¤ï¼Œå¹¶å¯ä»¥ä»å®—ä¸»å›½çš„å…ˆè¿›æŠ€æœ¯ä¸­å—ç›Š",
            "timeline_origin_overtuned": "å¼ºå¤ºå¤©å·¥_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜å·²ç»æŒæ¡äº†åŸºå› å·¥ç¨‹çš„è‰ºæœ¯ï¼Œä»–ä»¬ä¸æ–­åœ°è°ƒæ•´è‡ªå·±çš„èº«ä½“ï¼Œä»¥è¿½æ±‚å®Œç¾ã€‚ä»–ä»¬çš„é¢†å¯¼äººç—´è¿·äºæ•ˆç‡å’Œç”Ÿäº§åŠ›ï¼Œä»–ä»¬å°†ä¸æƒœä¸€åˆ‡ä»£ä»·æ¥å®ç°è‡ªå·±çš„ç›®æ ‡",
            "timeline_origin_toxic_knights": "æ¯’åœ£éª‘å£«_å¸å›½èµ·æº_[ç©å®¶å¸å›½]ä¸€ç¾¤ç¥ç§˜çš„éª‘å£«æ¥åˆ°äº†è¿™ä¸ªæ–‡æ˜çš„æ¯æ˜Ÿï¼Œä»–ä»¬æ‰¿è¯ºä¼šä¿æŠ¤ä»–ä»¬å…å—é“¶æ²³ç³»ä¸­æ½œä¼çš„ææ€–åŠ¿åŠ›çš„ä¾µå®³ã€‚ä»–ä»¬å¸¦æ¥äº†ä¸€ç§ç¥ç§˜çš„\'æ¯’æ¶²\'ï¼Œä»–ä»¬è¯´è¿™ç§æ¯’æ¶²å¯ä»¥èµ‹äºˆä»–ä»¬è¶…äººçš„åŠ›é‡ï¼Œä½†ä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ",
            "timeline_origin_payback": "è¡€å€ºè¡€å¿_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜çš„æ¯æ˜Ÿæ›¾è¢«ä¸€ä¸ªæ›´å¼ºå¤§çš„æ˜Ÿé™…å¸å›½å¾æœå’Œå¥´å½¹ã€‚åœ¨å¤šå¹´çš„å‹è¿«ä¹‹åï¼Œä»–ä»¬ç»ˆäºæˆåŠŸåœ°å‘åŠ¨äº†ä¸€åœºæˆåŠŸçš„èµ·ä¹‰ï¼Œå¹¶èµ¢å¾—äº†è‡ªç”±ã€‚ä½†ä»–ä»¬æ°¸è¿œä¸ä¼šå¿˜è®°ä»–ä»¬æ‰€é­å—çš„è‹¦éš¾ï¼Œä»–ä»¬å‘èª“è¦å‘ä»–ä»¬çš„å‰å‹è¿«è€…å¤ä»‡",
            "timeline_origin_broken_shackles": "ç²‰ç¢çš„æ·é”_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜ç”±æ¥è‡ªé“¶æ²³ç³»å„åœ°ä¸åŒç‰©ç§çš„éš¾æ°‘å’Œé€ƒäº¡çš„å¥´éš¶ç»„æˆã€‚ä»–ä»¬åœ¨å…±åŒçš„è‹¦éš¾ä¸­æ‰¾åˆ°äº†å›¢ç»“ï¼Œå¹¶å»ºç«‹äº†ä¸€ä¸ªæ–°çš„ç¤¾ä¼šï¼Œåœ¨è¿™ä¸ªç¤¾ä¼šä¸­ï¼Œæ‰€æœ‰äººéƒ½ç”Ÿè€Œå¹³ç­‰ã€‚ä»–ä»¬å‘èª“è¦è§£æ”¾æ‰€æœ‰è¢«å¥´å½¹çš„äººæ°‘ï¼Œå¹¶ç²‰ç¢å‹è¿«ä»–ä»¬çš„æ·é”",
            "timeline_origin_fear_of_the_dark": "é»‘æš—ä¹‹æ€–_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜å¯¹é»‘æš—æœ‰ç€ä¸€ç§éç†æ€§çš„ææƒ§ã€‚ä»–ä»¬ç›¸ä¿¡ï¼Œåœ¨ç¾¤æ˜Ÿä¹‹é—´çš„è™šç©ºä¸­æ½œä¼ç€ä¸€äº›å¯æ€•çš„ä¸œè¥¿ï¼Œä»–ä»¬ä¼šä¸æƒœä¸€åˆ‡ä»£ä»·é¿å…ä¸å®ƒæ¥è§¦ã€‚ä»–ä»¬å°†è‡ªå·±çš„æ–‡æ˜å±€é™åœ¨è‡ªå·±çš„å¤ªé˜³ç³»ä¸­ï¼Œå¹¶å¸Œæœ›æ°¸è¿œä¸ä¼šæœ‰ä»»ä½•ä¸œè¥¿æ¥æ‰“æ‰°ä»–ä»¬",
            "timeline_origin_riftworld": "è£‚éš™å½“ç©º_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜çš„æ¯æ˜Ÿæ­£å¤„äºè¢«ä¸€ä¸ªå·¨å¤§çš„ã€ä¸æ–­æ‰©å¤§çš„æ—¶ç©ºè£‚ç¼åå™¬çš„è¾¹ç¼˜ã€‚ä»–ä»¬å¿…é¡»åœ¨è‡ªå·±çš„ä¸–ç•Œè¢«æ’•è£‚ä¹‹å‰æ‰¾åˆ°é€ƒç¦»çš„æ–¹æ³•",
            "timeline_origin_cybernetic_creed": "ä¹‰ä½“ä¿¡æ¡_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜ç›¸ä¿¡ï¼Œæœ‰æœºä½“æ˜¯è„†å¼±å’Œä¸å®Œç¾çš„ã€‚ä»–ä»¬å¯»æ±‚é€šè¿‡æ§åˆ¶è®ºæ¥è¶…è¶Šè‡ªå·±çš„è‚‰ä½“ï¼Œå¹¶æˆä¸ºä¸€ç§æ–°çš„ã€æ›´é«˜çº§çš„å­˜åœ¨å½¢å¼",
            "timeline_origin_synthetic_fertility": "åˆæˆç¹è¡_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜å·²ç»å¤±å»äº†è‡ªç„¶ç¹æ®–çš„èƒ½åŠ›ã€‚ä»–ä»¬ç°åœ¨ä¾é å…ˆè¿›çš„æœºå™¨äººæŠ€æœ¯å’ŒåŸºå› å·¥ç¨‹æ¥åˆ›é€ æ–°çš„åä»£ã€‚ä½†è¿™ç§å¯¹æŠ€æœ¯çš„ä¾èµ–ä¹Ÿè®©ä»–ä»¬å˜å¾—è„†å¼±",
            "timeline_origin_arc_welders": "ç”µå¼§ç„Šæœº_å¸å›½èµ·æº_[ç©å®¶å¸å›½]è¿™ä¸ªæ–‡æ˜ç”±ä¸€ç¾¤æŠ€æœ¯å¨´ç†Ÿçš„å·¥ç¨‹å¸ˆå’Œå·¥åŒ ç»„æˆï¼Œä»–ä»¬æ“…é•¿å»ºé€ å’Œç»´ä¿®å¤§å‹ç»“æ„ã€‚ä»–ä»¬ä»¥å…¶åœ¨ç”µå¼§ç„Šæ–¹é¢çš„ä¸“ä¸šçŸ¥è¯†è€Œé—»åï¼Œä»–ä»¬å¯ä»¥ç”¨å®ƒæ¥åˆ›é€ å‡ºä»¤äººæƒŠå¹çš„è‰ºæœ¯å“å’Œå¼ºå¤§çš„æˆ˜äº‰æœºå™¨"
        }
    
    def _initialize_empire_data(self) -> Dict[str, Any]:
        """åˆå§‹åŒ–å¸å›½ç”Ÿæˆæ‰€éœ€çš„æ•°æ®"""
        return {
            # ç‰©ç§è‚–åƒåˆ—è¡¨
            'portraits': [
                {'name': 'ç±»äºº', 'weight': 15},
                {'name': 'å“ºä¹³ç±»', 'weight': 12},
                {'name': 'çˆ¬è¡Œç±»', 'weight': 12},
                {'name': 'é¸Ÿç±»', 'weight': 12},
                {'name': 'èŠ‚è‚¢ç±»', 'weight': 12},
                {'name': 'è½¯ä½“ç±»', 'weight': 10},
                {'name': 'çœŸèŒç±»', 'weight': 9},
                {'name': 'å²©çŸ³ç±»', 'weight': 8},
                {'name': 'æ¤ç‰©ç±»', 'weight': 7},
                {'name': 'æ°´ç”Ÿç±»', 'weight': 3}
            ],
            
            # åç§°åˆ—è¡¨æ˜ å°„
            'name_lists': {
                'ç±»äºº': ['äººç±»è”åˆå›½', 'åœ°çƒè”é‚¦', 'å¤ªé˜³ç³»è”ç›Ÿ', 'äººç±»æ®–æ°‘è€…è”é‚¦', 'åœ°çƒå…±åŒä½“', 'æ³°æ‹‰è”é‚¦'],
                'å“ºä¹³ç±»': ['å…½æ—è”ç›Ÿ', 'é‡å…½å¸å›½', 'æ¯›æ—å…±å’Œå›½', 'å…½äººç‹å›½', 'é‡æ€§éƒ¨è½', 'çˆªç‰™è”é‚¦'],
                'çˆ¬è¡Œç±»': ['é³ç”²å¸å›½', 'çˆ¬è™«è”ç›Ÿ', 'å†·è¡€ç‹æœ', 'èœ¥èœ´å…±å’Œå›½', 'è›‡æ—è”é‚¦', 'é¾™è¡€å¸å›½'],
                'é¸Ÿç±»': ['ç¾½ç¿¼ç‹å›½', 'é£è¡Œè€…è”ç›Ÿ', 'å¤©ç©ºå¸å›½', 'ç¿¼æ—å…±å’Œå›½', 'é¸Ÿäººè”é‚¦', 'é«˜ç¿”é›†ç¾¤'],
                'èŠ‚è‚¢ç±»': ['è™«æ—èœ‚å·¢', 'èŠ‚è‚¢å¸å›½', 'ç”²å£³è”ç›Ÿ', 'æ˜†è™«ç‹å›½', 'è››ç½‘å…±åŒä½“', 'å¤šè¶³è”åˆ'],
                'è½¯ä½“ç±»': ['è§¦æ‰‹å¸å›½', 'è½¯ä½“è”ç›Ÿ', 'æµ·æ´‹ç‹å›½', 'æ¹¿æ¶¦å…±å’Œå›½', 'ç²˜æ¶²è”é‚¦', 'æ·±æ¸Šé›†ç¾¤'],
                'çœŸèŒç±»': ['èŒä¸ç½‘ç»œ', 'çœŸèŒç‹å›½', 'å­¢å­è”ç›Ÿ', 'è…èš€å¸å›½', 'èŒè½å…±åŒä½“', 'å­¢å­é›†ç¾¤'],
                'å²©çŸ³ç±»': ['å²©çŸ³è”ç›Ÿ', 'çŸ³å¤´å¸å›½', 'çŸ¿ç‰©ç‹å›½', 'æ™¶ä½“å…±å’Œå›½', 'åœ°è´¨è”é‚¦', 'ç¡…åŸºé›†ç¾¤'],
                'æ¤ç‰©ç±»': ['å¶ç»¿è”ç›Ÿ', 'æ¤ç‰©ç‹å›½', 'èŠ±å›­å¸å›½', 'æ ¹ç³»ç½‘ç»œ', 'å…‰åˆå…±åŒä½“', 'ç»¿å¶é›†ç¾¤'],
                'æ°´ç”Ÿç±»': ['æ·±æµ·å¸å›½', 'æ°´æ—è”ç›Ÿ', 'æµ·æ´‹ç‹å›½', 'æ½®æ±å…±å’Œå›½', 'æ°´æµè”é‚¦', 'æ·±è“é›†ç¾¤']
            },
            
            # æ€æ½®åˆ—è¡¨
            'ethics': [
                {'name': 'æ’å¤–ä¸»ä¹‰', 'opposite': 'äº²å¤–ä¸»ä¹‰', 'weight': 20},
                {'name': 'äº²å¤–ä¸»ä¹‰', 'opposite': 'æ’å¤–ä¸»ä¹‰', 'weight': 15},
                {'name': 'å”¯ç‰©ä¸»ä¹‰', 'opposite': 'å”¯å¿ƒä¸»ä¹‰', 'weight': 25},
                {'name': 'å”¯å¿ƒä¸»ä¹‰', 'opposite': 'å”¯ç‰©ä¸»ä¹‰', 'weight': 20},
                {'name': 'å¨æƒä¸»ä¹‰', 'opposite': 'å¹³ç­‰ä¸»ä¹‰', 'weight': 22},
                {'name': 'å¹³ç­‰ä¸»ä¹‰', 'opposite': 'å¨æƒä¸»ä¹‰', 'weight': 18},
                {'name': 'å†›å›½ä¸»ä¹‰', 'opposite': 'å’Œå¹³ä¸»ä¹‰', 'weight': 25},
                {'name': 'å’Œå¹³ä¸»ä¹‰', 'opposite': 'å†›å›½ä¸»ä¹‰', 'weight': 15}
            ],
            
            # æ”¿ä½“åˆ—è¡¨
            'authorities': [
                {'name': 'æ°‘ä¸»åˆ¶', 'weight': 25, 'forbidden_ethics': ['å¨æƒä¸»ä¹‰', 'æç«¯å¨æƒä¸»ä¹‰']},
                {'name': 'å¯¡å¤´åˆ¶', 'weight': 30, 'requirements': {}},
                {'name': 'ç‹¬è£åˆ¶', 'weight': 25, 'forbidden_ethics': ['å¹³ç­‰ä¸»ä¹‰', 'æç«¯å¹³ç­‰ä¸»ä¹‰']},
                {'name': 'å¸åˆ¶', 'weight': 20, 'required_ethics': ['å¨æƒä¸»ä¹‰', 'æç«¯å¨æƒä¸»ä¹‰']}
            ],
            
            # å •è½å¸å›½é…ç½®
            'fallen_empires': [
                {
                    'name': 'å¸Œæ‹‰å¤šç§å¸å›½',
                    'type': 'åœ£åœ°å®ˆæŠ¤è€…',
                    'ethics': ['æç«¯å”¯å¿ƒä¸»ä¹‰', 'å’Œå¹³ä¸»ä¹‰'],
                    'personality': 'ç‹‚çƒ­çš„å­¤ç«‹ä¸»ä¹‰è€…',
                    'species': 'å¸Œæ‹‰å¤šç§æ—'
                },
                {
                    'name': 'é˜¿å°”æ³•çŸ¥è¯†è€…è”ç›Ÿ',
                    'type': 'çŸ¥è¯†ç®¡ç†è€…', 
                    'ethics': ['æç«¯å”¯ç‰©ä¸»ä¹‰', 'å’Œå¹³ä¸»ä¹‰'],
                    'personality': 'å›ºæ‰§çš„å­¦è€…',
                    'species': 'é˜¿å°”æ³•ç§æ—'
                },
                {
                    'name': 'å†›äº‹å­¤ç«‹è€…å¸å›½',
                    'type': 'å†›äº‹å­¤ç«‹è€…',
                    'ethics': ['æç«¯æ’å¤–ä¸»ä¹‰', 'å†›å›½ä¸»ä¹‰'],
                    'personality': 'è­¦æƒ•çš„å¸å›½ä¸»ä¹‰è€…',
                    'species': 'å­¤ç«‹è€…ç§æ—'
                },
                {
                    'name': 'æ°¸æ’è­¦å«è€…',
                    'type': 'è‰ºæœ¯èµåŠ©è€…',
                    'ethics': ['æç«¯å¹³ç­‰ä¸»ä¹‰', 'å”¯å¿ƒä¸»ä¹‰'],
                    'personality': 'æ…ˆå–„çš„ä¿æŠ¤è€…',
                    'species': 'è­¦å«è€…ç§æ—'
                }
            ],
            
            # ç‰¹è´¨åˆ—è¡¨
            'traits': {
                'positive': [
                    {'name': 'æ™ºæ…§', 'cost': 2, 'weight': 20},
                    {'name': 'å¼ºå£®', 'cost': 1, 'weight': 15},
                    {'name': 'å¤©ç”Ÿå·¥ç¨‹å¸ˆ', 'cost': 1, 'weight': 10},
                    {'name': 'å¿«é€Ÿå¢æ®–', 'cost': 2, 'weight': 15},
                    {'name': 'é€‚åº”æ€§å¼º', 'cost': 2, 'weight': 12},
                    {'name': 'é•¿å¯¿', 'cost': 1, 'weight': 8},
                    {'name': 'å¤©ç”Ÿç‰©ç†å­¦å®¶', 'cost': 1, 'weight': 10},
                    {'name': 'å¤©ç”Ÿç¤¾ä¼šå­¦å®¶', 'cost': 1, 'weight': 10}
                ],
                'negative': [
                    {'name': 'æŸ”å¼±', 'gain': 1, 'weight': 15},
                    {'name': 'ç”Ÿé•¿ç¼“æ…¢', 'gain': 1, 'weight': 12},
                    {'name': 'ç¦»ç»å›é“', 'gain': 1, 'weight': 10},
                    {'name': 'ä¸å–„å˜é€š', 'gain': 2, 'weight': 8},
                    {'name': 'ä»¤äººåŒæ¶', 'gain': 1, 'weight': 5},
                    {'name': 'çŸ­å¯¿', 'gain': 1, 'weight': 10}
                ]
            },
            
            # äº‹ä»¶å€¾å‘æ€§
            'event_tendencies': {
                'timeline_first_war_declared': {
                    'favored_ethics': ['å†›å›½ä¸»ä¹‰', 'æç«¯å†›å›½ä¸»ä¹‰', 'å¨æƒä¸»ä¹‰'],
                    'weights': [40, 60, 30]
                },
                'timeline_first_contact': {
                    'favored_ethics': ['äº²å¤–ä¸»ä¹‰', 'æç«¯äº²å¤–ä¸»ä¹‰'],
                    'weights': [35, 50]
                },
                'timeline_first_espionage_operation': {
                    'favored_ethics': ['æ’å¤–ä¸»ä¹‰', 'å¨æƒä¸»ä¹‰', 'å†›å›½ä¸»ä¹‰'],
                    'weights': [30, 25, 35]
                },
                'timeline_elections': {
                    'favored_ethics': ['å¹³ç­‰ä¸»ä¹‰', 'æç«¯å¹³ç­‰ä¸»ä¹‰'],
                    'weights': [40, 60],
                    'forbidden_ethics': ['å¨æƒä¸»ä¹‰', 'æç«¯å¨æƒä¸»ä¹‰']
                }
            }
        }
    
    def set_player_empire_name(self, empire_name: str):
        """
        è®¾ç½®ç©å®¶å¸å›½åç§°
        
        Args:
            empire_name: ç©å®¶è¾“å…¥çš„å¸å›½åç§°
        """
        if empire_name and empire_name.strip():
            self.player_empire_name = empire_name.strip()
            print(f"âœ… ç©å®¶å¸å›½åç§°è®¾ç½®ä¸º: {self.player_empire_name}")
        else:
            print("âœ… ä½¿ç”¨é»˜è®¤å¸å›½åç§°: ç©å®¶å¸å›½")
    
    def set_year_markers_option(self, include_year_markers: bool):
        """
        è®¾ç½®æ˜¯å¦åŒ…å«å¹´åº¦æ ‡è®°äº‹ä»¶
        
        Args:
            include_year_markers: æ˜¯å¦åŒ…å«å¹´åº¦æ ‡è®°äº‹ä»¶
        """
        self.include_year_markers = include_year_markers
        if include_year_markers:
            print("âœ… å°†åŒ…å«å¹´åº¦æ ‡è®°äº‹ä»¶")
        else:
            print("âœ… å°†è·³è¿‡å¹´åº¦æ ‡è®°äº‹ä»¶")
    
    def parse_save_file(self, file_path: str) -> bool:
        """
        è§£æå­˜æ¡£æ–‡ä»¶å¹¶æå–timeline_events
        
        Args:
            file_path: å­˜æ¡£æ–‡ä»¶è·¯å¾„
            
        Returns:
            bool: æ˜¯å¦æˆåŠŸè§£æ
        """
        print(f"\nğŸ” å¼€å§‹è§£æå­˜æ¡£æ–‡ä»¶: {file_path}")
        
        try:
            # è¯»å–æ–‡ä»¶
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
            
            print(f"âœ… æ–‡ä»¶è¯»å–æˆåŠŸï¼Œå¤§å°: {len(content):,} å­—ç¬¦")
            
            # å®šä½timeline_eventsæ•°æ®å—
            timeline_match = re.search(r'timeline_events\s*=\s*\{', content)
            if not timeline_match:
                print("âŒ æœªæ‰¾åˆ°timeline_eventsæ•°æ®å—")
                return False
            
            print("âœ… æ‰¾åˆ°timeline_eventsæ•°æ®å—ï¼Œå¼€å§‹æå–äº‹ä»¶...")
            
            # æå–timeline_eventså†…å®¹
            start_pos = timeline_match.end() - 1  # åŒ…å«å¼€å¤´çš„{
            brace_count = 0
            end_pos = start_pos
            
            for i, char in enumerate(content[start_pos:], start_pos):
                if char == '{':
                    brace_count += 1
                elif char == '}':
                    brace_count -= 1
                    if brace_count == 0:
                        end_pos = i + 1
                        break
            
            timeline_content = content[start_pos:end_pos]
            print(f"âœ… timeline_eventså†…å®¹æå–å®Œæˆï¼Œé•¿åº¦: {len(timeline_content):,} å­—ç¬¦")
            
            # è§£æäº‹ä»¶
            self._parse_timeline_events(timeline_content)
            
            print(f"âœ… äº‹ä»¶è§£æå®Œæˆï¼Œå…±æ‰¾åˆ° {len(self.timeline_events)} ä¸ªäº‹ä»¶")
            return True
            
        except FileNotFoundError:
            print(f"âŒ æ–‡ä»¶æœªæ‰¾åˆ°: {file_path}")
            return False
        except Exception as e:
            print(f"âŒ è§£ææ–‡ä»¶æ—¶å‡ºé”™: {str(e)}")
            return False
    
    def _parse_timeline_events(self, timeline_content: str):
        """
        è§£ætimeline_eventså†…å®¹
        
        Args:
            timeline_content: timeline_eventsçš„åŸå§‹å†…å®¹
        """
        # æ›´ç²¾ç¡®çš„äº‹ä»¶å—è§£æ
        events = []
        lines = timeline_content.split('\n')
        current_event = None
        brace_count = 0
        in_event = False
        
        for line_num, line in enumerate(lines):
            line = line.strip()
            if not line:
                continue
            
            # è®¡ç®—å¤§æ‹¬å·æ•°é‡
            line_brace_count = line.count('{') - line.count('}')
            brace_count += line_brace_count
            
            # æ£€æµ‹äº‹ä»¶å¼€å§‹ - åŒæ—¶åŒ…å«dateå’Œdefinitionçš„è¡Œï¼Œæˆ–è€…å•ç‹¬çš„å¼€å§‹å¤§æ‹¬å·
            if not in_event and line == '{' and brace_count >= 2:
                in_event = True
                current_event = {'lines': [], 'start_line': line_num}
            elif in_event and current_event is not None:
                current_event['lines'].append(line)
                
                # æ£€æµ‹äº‹ä»¶ç»“æŸ - å•ç‹¬çš„ç»“æŸå¤§æ‹¬å·ä¸”å±‚çº§æ­£ç¡®
                if line == '}' and brace_count == 1:
                    # è§£æå®Œæ•´äº‹ä»¶
                    event_text = '\n'.join(current_event['lines'])
                    parsed_event = self._parse_single_event(event_text)
                    if parsed_event:
                        events.append(parsed_event)
                    
                    in_event = False
                    current_event = None
        
        # æŒ‰æ—¥æœŸæ’åºå¹¶å­˜å‚¨
        events.sort(key=lambda x: x.date)
        self.timeline_events = events
    
    def _parse_single_event(self, event_text: str) -> Optional[TimelineEvent]:
        """
        è§£æå•ä¸ªäº‹ä»¶
        
        Args:
            event_text: äº‹ä»¶çš„å®Œæ•´æ–‡æœ¬
            
        Returns:
            TimelineEvent: è§£æåçš„äº‹ä»¶å¯¹è±¡ï¼Œå¦‚æœè§£æå¤±è´¥è¿”å›None
        """
        try:
            # æå–dateå’Œdefinition - é€‚åº”å®é™…æ ¼å¼
            date_match = re.search(r'date\s*=\s*"([^"]+)"', event_text)
            definition_match = re.search(r'definition\s*=\s*"([^"]+)"', event_text)
            
            if not date_match or not definition_match:
                return None
            
            date_str = date_match.group(1)
            definition = definition_match.group(1)
            
            # è§£ædataéƒ¨åˆ†
            data = {}
            data_match = re.search(r'data\s*=\s*\{([^}]*)\}', event_text, re.DOTALL)
            if data_match:
                data_content = data_match.group(1).strip()
                
                # æ£€æŸ¥æ˜¯å¦æ˜¯çº¯æ•°å­—åºåˆ—ï¼ˆå¦‚ "0 7"ï¼‰
                if re.match(r'^[\d\s]+$', data_content):
                    # æ•°å­—åºåˆ—å½¢å¼
                    numbers = [int(x) for x in data_content.split() if x.isdigit()]
                    data['numbers'] = numbers
                elif re.search(r'^\s*\d+\s*=', data_content, re.MULTILINE):
                    # æ•°ç»„å½¢å¼: 0="value1" 1="value2"
                    data_pairs = re.findall(r'(\d+)\s*=\s*"([^"]*)"', data_content)
                    data['items'] = [value for _, value in sorted(data_pairs, key=lambda x: int(x[0]))]
                else:
                    # é”®å€¼å¯¹å½¢å¼
                    data_pairs = re.findall(r'(\w+)\s*=\s*"([^"]*)"', data_content)
                    for key, value in data_pairs:
                        data[key] = value
            
            return TimelineEvent(
                date=date_str,
                definition=definition,
                data=data,
                raw_text=event_text
            )
            
        except Exception as e:
            print(f"âš ï¸  è§£æäº‹ä»¶æ—¶å‡ºé”™: {str(e)}")
            return None
    
    def generate_initial_chronicle(self) -> str:
        """
        ç”Ÿæˆåˆç‰ˆç¼–å¹´å²ï¼ˆåŒ…å«å ä½ç¬¦ï¼‰
        
        Returns:
            str: åˆç‰ˆç¼–å¹´å²æ–‡æœ¬
        """
        print("\nğŸ“ å¼€å§‹ç”Ÿæˆåˆç‰ˆç¼–å¹´å²...")
        
        chronicle_lines = []
        chronicle_lines.append("=" * 60)
        chronicle_lines.append("ç¾¤æ˜Ÿå¸å›½ç¼–å¹´å²")
        chronicle_lines.append("=" * 60)
        chronicle_lines.append("")
        
        # ç»Ÿè®¡è¿‡æ»¤çš„äº‹ä»¶æ•°é‡
        filtered_events = 0
        total_events = len(self.timeline_events)
        
        for event in self.timeline_events:
            # æ£€æŸ¥æ˜¯å¦åº”è¯¥è·³è¿‡å¹´åº¦æ ‡è®°äº‹ä»¶
            if not self.include_year_markers and event.definition == "timeline_event_year":
                filtered_events += 1
                continue
                
            event_text = self._convert_event_to_text(event)
            chronicle_lines.append(f"{event.date} - {event_text}")
        
        initial_chronicle = "\n".join(chronicle_lines)
        
        if filtered_events > 0:
            print(f"âœ… åˆç‰ˆç¼–å¹´å²ç”Ÿæˆå®Œæˆï¼Œå…± {total_events - filtered_events} ä¸ªäº‹ä»¶ï¼ˆå·²è¿‡æ»¤ {filtered_events} ä¸ªå¹´åº¦æ ‡è®°äº‹ä»¶ï¼‰")
        else:
            print(f"âœ… åˆç‰ˆç¼–å¹´å²ç”Ÿæˆå®Œæˆï¼Œå…± {total_events} ä¸ªäº‹ä»¶")
        
        return initial_chronicle
    
    def _convert_event_to_text(self, event: TimelineEvent) -> str:
        """
        å°†äº‹ä»¶è½¬æ¢ä¸ºæè¿°æ–‡æœ¬
        
        Args:
            event: æ—¶é—´çº¿äº‹ä»¶
            
        Returns:
            str: äº‹ä»¶æè¿°æ–‡æœ¬
        """
        # æŸ¥æ‰¾äº‹ä»¶æè¿°æ¨¡æ¿
        if event.definition in self.event_descriptions:
            template = self.event_descriptions[event.definition]
            
            # å‡†å¤‡æ ¼å¼åŒ–å‚æ•°
            format_args = {'date': event.date}
            format_args.update(event.data)
            
            # å®‰å…¨çš„æ ¼å¼åŒ–ï¼Œé¿å…ç¼ºå°‘å‚æ•°
            try:
                # å…ˆæ‰¾å‡ºæ¨¡æ¿ä¸­éœ€è¦çš„æ‰€æœ‰å ä½ç¬¦
                import string
                formatter = string.Formatter()
                required_fields = [field for _, field, _, _ in formatter.parse(template) if field]
                
                # ä¸ºç¼ºå¤±çš„å­—æ®µæä¾›é»˜è®¤å€¼
                for field in required_fields:
                    if field not in format_args:
                        if field == 'location':
                            format_args[field] = 'æœªçŸ¥æ˜Ÿç³»'
                        elif field == 'colony_name':
                            format_args[field] = 'æ–°æ®–æ°‘åœ°'
                        elif field == 'system_name':
                            format_args[field] = 'æœªçŸ¥æ’æ˜Ÿç³»'
                        elif field == 'leader_name':
                            format_args[field] = 'æœªçŸ¥é¢†è¢–'
                        elif field == 'planet_name':
                            format_args[field] = 'æœªçŸ¥æ˜Ÿçƒ'
                        elif field == 'fleet_name':
                            format_args[field] = 'æ— æ•Œèˆ°é˜Ÿ'
                        elif field == 'ship_name':
                            format_args[field] = 'æ——èˆ°'
                        elif field == 'new_capital':
                            format_args[field] = 'æ–°é¦–éƒ½'
                        elif field == 'leviathan_name':
                            format_args[field] = 'æ˜Ÿå…½'
                        elif field.endswith('_empire'):
                            # éœ€è¦ç”Ÿæˆå¸å›½å ä½ç¬¦
                            format_args[field] = f'å¸å›½{len(self.generated_entities) + 1}'
                        elif field.endswith('_fallen_empire'):
                            format_args[field] = f'å •è½å¸å›½{len([e for e in self.generated_entities.values() if e.entity_type == "fallen_empire"]) + 1}'
                        else:
                            format_args[field] = f'æœªçŸ¥_{field}'
                
                text = template.format(**format_args)
                
                # å¤„ç†éœ€è¦ç”Ÿæˆå®ä½“çš„å ä½ç¬¦
                text = self._process_entity_placeholders(text, event)
                
                return text
                
            except Exception as e:
                print(f"âš ï¸  æ ¼å¼åŒ–äº‹ä»¶æè¿°æ—¶å‡ºé”™ ({event.definition}): {str(e)}")
                return f"{event.definition} ({event.date}) - æ ¼å¼åŒ–é”™è¯¯"
        else:
            # æœªæ”¶å½•çš„äº‹ä»¶ä»£ç 
            return f"æœªæ”¶å½•äº‹ä»¶ä»£ç  ({event.definition})ï¼Œæ¬¢è¿è¡¥å……ï¼"
    
    def _process_entity_placeholders(self, text: str, event: TimelineEvent) -> str:
        """
        å¤„ç†æ–‡æœ¬ä¸­çš„å®ä½“å ä½ç¬¦
        
        Args:
            text: åŒ…å«å ä½ç¬¦çš„æ–‡æœ¬
            event: å½“å‰äº‹ä»¶
            
        Returns:
            str: å¤„ç†åçš„æ–‡æœ¬
        """
        # æŸ¥æ‰¾æ‰€æœ‰éœ€è¦æ›¿æ¢çš„å ä½ç¬¦
        placeholders = re.findall(r'\[([^\]]+)\]', text)
        
        for placeholder in placeholders:
            if placeholder not in self.generated_entities:
                # ç”Ÿæˆæ–°å®ä½“
                entity = self._generate_entity_for_placeholder(placeholder, event)
                if entity:
                    self.generated_entities[placeholder] = entity
        
        return text
    
    def _generate_entity_for_placeholder(self, placeholder: str, event: TimelineEvent) -> Optional[GeneratedEntity]:
        """
        ä¸ºå ä½ç¬¦ç”Ÿæˆå¯¹åº”çš„å®ä½“
        
        Args:
            placeholder: å ä½ç¬¦æ–‡æœ¬ (å¦‚ "å¸å›½1", "ç§æ—1")
            event: è§¦å‘ç”Ÿæˆçš„äº‹ä»¶
            
        Returns:
            GeneratedEntity: ç”Ÿæˆçš„å®ä½“
        """
        if placeholder.startswith('å¸å›½'):
            return self._generate_ai_empire(placeholder, event)
        elif placeholder.startswith('å •è½å¸å›½'):
            return self._generate_fallen_empire(placeholder, event)
        elif placeholder.startswith('ç§æ—'):
            return self._generate_species(placeholder, event)
        elif placeholder == 'ç©å®¶å¸å›½':
            # ç©å®¶å¸å›½ä¸éœ€è¦ç”Ÿæˆï¼Œç›´æ¥ä½¿ç”¨å ä½ç¬¦
            return None
        
        return None
    
    def _generate_ai_empire(self, placeholder: str, event: TimelineEvent) -> GeneratedEntity:
        """ç”ŸæˆAIå¸å›½"""
        self.entity_counters['empire'] += 1
        
        # æ ¹æ®äº‹ä»¶ç±»å‹ç¡®å®šå€¾å‘æ€§
        event_bias = None
        if event.definition in self.empire_generation_data['event_tendencies']:
            event_bias = event.definition
        
        # ç”Ÿæˆç‰©ç§
        portrait = self._weighted_random(self.empire_generation_data['portraits'])
        species_name = f"{portrait['name']}ç§æ—{self.entity_counters['empire']}"
        
        # ç”Ÿæˆæ€æ½®ï¼ˆåŸºäºäº‹ä»¶å€¾å‘ï¼‰
        ethics = self._generate_ethics(event_bias)
        
        # ç”Ÿæˆæ”¿ä½“
        authority = self._select_authority(ethics)
        
        # ç”Ÿæˆå¸å›½åç§°
        name_options = self.empire_generation_data['name_lists'][portrait['name']]
        empire_name = random.choice(name_options) + f"ç¬¬{self.entity_counters['empire']}å…±åŒä½“"
        
        # ç”Ÿæˆç‰¹è´¨
        traits = self._generate_traits()
        
        properties = {
            'name': empire_name,
            'species': species_name,
            'portrait': portrait['name'],
            'ethics': ethics,
            'authority': authority,
            'traits': traits,
            'personality': self._generate_personality(ethics),
            'type': 'ai_empire'
        }
        
        return GeneratedEntity(
            entity_type='empire',
            name=empire_name,
            properties=properties,
            placeholder_id=placeholder
        )
    
    def _generate_fallen_empire(self, placeholder: str, event: TimelineEvent) -> GeneratedEntity:
        """ç”Ÿæˆå •è½å¸å›½"""
        # ä»é¢„å®šä¹‰çš„å •è½å¸å›½ä¸­é€‰æ‹©
        fallen_empire_config = random.choice(self.empire_generation_data['fallen_empires'])
        
        properties = {
            'name': fallen_empire_config['name'],
            'species': fallen_empire_config['species'],
            'type_name': fallen_empire_config['type'],
            'ethics': fallen_empire_config['ethics'],
            'personality': fallen_empire_config['personality'],
            'type': 'fallen_empire'
        }
        
        return GeneratedEntity(
            entity_type='fallen_empire',
            name=fallen_empire_config['name'],
            properties=properties,
            placeholder_id=placeholder
        )
    
    def _generate_species(self, placeholder: str, event: TimelineEvent) -> GeneratedEntity:
        """ç”Ÿæˆç§æ—"""
        self.entity_counters['species'] += 1
        
        portrait = self._weighted_random(self.empire_generation_data['portraits'])
        species_name = f"{portrait['name']}æ—{self.entity_counters['species']}"
        traits = self._generate_traits()
        
        properties = {
            'name': species_name,
            'portrait': portrait['name'],
            'traits': traits,
            'type': 'species'
        }
        
        return GeneratedEntity(
            entity_type='species',
            name=species_name,
            properties=properties,
            placeholder_id=placeholder
        )
    
    def _weighted_random(self, items: List[Dict[str, Any]]) -> Dict[str, Any]:
        """æƒé‡éšæœºé€‰æ‹©"""
        total_weight = sum(item['weight'] for item in items)
        random_value = random.randint(1, total_weight)
        
        current_weight = 0
        for item in items:
            current_weight += item['weight']
            if random_value <= current_weight:
                return item
        
        return items[-1]  # fallback
    
    def _generate_ethics(self, event_bias: Optional[str] = None) -> List[str]:
        """ç”Ÿæˆæ€æ½®"""
        ethics = []
        total_points = 3
        
        # å¦‚æœæœ‰äº‹ä»¶å€¾å‘æ€§ï¼Œä¼˜å…ˆè€ƒè™‘
        if event_bias and event_bias in self.empire_generation_data['event_tendencies']:
            tendency = self.empire_generation_data['event_tendencies'][event_bias]
            if 'favored_ethics' in tendency:
                favored_ethic = random.choice(tendency['favored_ethics'])
                ethics.append(favored_ethic)
                total_points -= 1
        
        # åˆ†é…å‰©ä½™ç‚¹æ•°
        available_ethics = [e['name'] for e in self.empire_generation_data['ethics']]
        used_opposites = set()
        
        while total_points > 0 and len(ethics) < 3:
            # è¿‡æ»¤æ‰å·²ä½¿ç”¨æ€æ½®çš„å¯¹ç«‹é¢
            filtered_ethics = []
            for ethic_data in self.empire_generation_data['ethics']:
                ethic_name = ethic_data['name']
                if ethic_name not in ethics and ethic_name not in used_opposites:
                    filtered_ethics.append(ethic_data)
            
            if not filtered_ethics:
                break
                
            selected_ethic_data = self._weighted_random(filtered_ethics)
            selected_ethic = selected_ethic_data['name']
            
            ethics.append(selected_ethic)
            used_opposites.add(selected_ethic_data['opposite'])
            total_points -= 1
        
        return ethics
    
    def _select_authority(self, ethics: List[str]) -> str:
        """æ ¹æ®æ€æ½®é€‰æ‹©æ”¿ä½“"""
        available_authorities = []
        
        for auth in self.empire_generation_data['authorities']:
            # æ£€æŸ¥ç¦æ­¢çš„æ€æ½®
            if 'forbidden_ethics' in auth:
                if any(ethic in ethics for ethic in auth['forbidden_ethics']):
                    continue
            
            # æ£€æŸ¥å¿…éœ€çš„æ€æ½®
            if 'required_ethics' in auth:
                if not any(ethic in ethics for ethic in auth['required_ethics']):
                    continue
            
            available_authorities.append(auth)
        
        if not available_authorities:
            available_authorities = [auth for auth in self.empire_generation_data['authorities'] 
                                   if 'requirements' in auth and not auth['requirements']]
        
        selected_auth = self._weighted_random(available_authorities)
        return selected_auth['name']
    
    def _generate_traits(self) -> List[str]:
        """ç”Ÿæˆç§æ—ç‰¹è´¨"""
        selected_traits = []
        total_cost = 0
        max_attempts = 20
        attempts = 0
        
        while total_cost <= 2 and len(selected_traits) < 5 and attempts < max_attempts:
            # 70%æ¦‚ç‡é€‰æ‹©æ­£é¢ç‰¹è´¨ï¼Œ30%æ¦‚ç‡é€‰æ‹©è´Ÿé¢ç‰¹è´¨
            use_positive = random.random() < 0.7
            trait_pool = (self.empire_generation_data['traits']['positive'] if use_positive 
                         else self.empire_generation_data['traits']['negative'])
            
            trait = self._weighted_random(trait_pool)
            
            if trait['name'] not in selected_traits:
                if use_positive:
                    new_cost = total_cost + trait['cost']
                else:
                    new_cost = total_cost - trait['gain']
                
                if new_cost <= 2:
                    selected_traits.append(trait['name'])
                    total_cost = new_cost
            
            attempts += 1
        
        return selected_traits
    
    def _generate_personality(self, ethics: List[str]) -> str:
        """æ ¹æ®æ€æ½®ç”Ÿæˆæ€§æ ¼"""
        personality_map = {
            'å†›å›½ä¸»ä¹‰': 'å¥½æˆ˜çš„å¾æœè€…',
            'æç«¯å†›å›½ä¸»ä¹‰': 'æ®‹é…·çš„å¾æœè€…',
            'å’Œå¹³ä¸»ä¹‰': 'å’Œå¹³çš„å•†äºº',
            'æç«¯å’Œå¹³ä¸»ä¹‰': 'ç”Ÿæ€çš„å’Œå¹³ä¸»ä¹‰è€…',
            'æ’å¤–ä¸»ä¹‰': 'å­¤ç«‹çš„å¸å›½ä¸»ä¹‰è€…',
            'æç«¯æ’å¤–ä¸»ä¹‰': 'ç‹‚çƒ­çš„æ’å¤–ä¸»ä¹‰è€…',
            'äº²å¤–ä¸»ä¹‰': 'å‹å¥½çš„å¤–äº¤å®˜',
            'æç«¯äº²å¤–ä¸»ä¹‰': 'ç‹‚çƒ­çš„å‹è°Šä½¿è€…',
            'å¨æƒä¸»ä¹‰': 'ä¸“åˆ¶çš„ç»Ÿæ²»è€…',
            'æç«¯å¨æƒä¸»ä¹‰': 'ç‹¬è£çš„æš´å›',
            'å¹³ç­‰ä¸»ä¹‰': 'æ°‘ä¸»çš„ç†æƒ³ä¸»ä¹‰è€…',
            'æç«¯å¹³ç­‰ä¸»ä¹‰': 'ç‹‚çƒ­çš„å¹³ç­‰ä¸»ä¹‰è€…',
            'å”¯ç‰©ä¸»ä¹‰': 'ç†æ€§çš„æ¢ç´¢è€…',
            'æç«¯å”¯ç‰©ä¸»ä¹‰': 'æŠ€æœ¯çš„ç‹‚çƒ­è€…',
            'å”¯å¿ƒä¸»ä¹‰': 'ç²¾ç¥çš„å“²å­¦å®¶',
            'æç«¯å”¯å¿ƒä¸»ä¹‰': 'ç‹‚çƒ­çš„ä¿¡å¾’'
        }
        
        for ethic in ethics:
            if ethic in personality_map:
                return personality_map[ethic]
        
        return 'è°¨æ…çš„å¸å›½ä¸»ä¹‰è€…'
    
    def generate_final_chronicle(self, initial_chronicle: str) -> str:
        """
        ç”Ÿæˆæœ€ç»ˆç¼–å¹´å²ï¼ˆæ›¿æ¢æ‰€æœ‰å ä½ç¬¦ï¼‰
        
        Args:
            initial_chronicle: åˆç‰ˆç¼–å¹´å²æ–‡æœ¬
            
        Returns:
            str: æœ€ç»ˆç¼–å¹´å²æ–‡æœ¬
        """
        print("\nğŸ”„ å¼€å§‹æ›¿æ¢å ä½ç¬¦ï¼Œç”Ÿæˆæœ€ç»ˆç¼–å¹´å²...")
        
        final_chronicle = initial_chronicle
        
        # æ›¿æ¢æ‰€æœ‰ç”Ÿæˆçš„å®ä½“å ä½ç¬¦
        for placeholder, entity in self.generated_entities.items():
            pattern = f"\\[{re.escape(placeholder)}\\]"
            final_chronicle = re.sub(pattern, entity.name, final_chronicle)
        
        # æ›¿æ¢ç©å®¶å¸å›½å ä½ç¬¦
        final_chronicle = re.sub(r'\[ç©å®¶å¸å›½\]', self.player_empire_name, final_chronicle)
        
        print(f"âœ… å ä½ç¬¦æ›¿æ¢å®Œæˆï¼Œå…±æ›¿æ¢äº† {len(self.generated_entities)} ä¸ªå®ä½“")
        
        return final_chronicle
    
    def generate_entities_settings_file(self) -> str:
        """
        ç”Ÿæˆå®ä½“è®¾å®šæ–‡ä»¶å†…å®¹
        
        Returns:
            str: è®¾å®šæ–‡ä»¶å†…å®¹
        """
        print("\nï¿½ ç”Ÿæˆå®ä½“è®¾å®šæ–‡ä»¶...")
        
        lines = []
        lines.append("=" * 60)
        lines.append("ç¾¤æ˜Ÿå¸å›½ç¼–å¹´å² - åŠ¨æ€ç”Ÿæˆå®ä½“è®¾å®š")
        lines.append("=" * 60)
        lines.append("")
        lines.append(f"ç”Ÿæˆæ—¶é—´: {datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')}")
        lines.append(f"æ€»è®¡ç”Ÿæˆå®ä½“: {len(self.generated_entities)} ä¸ª")
        lines.append("")
        
        # æŒ‰ç±»å‹åˆ†ç»„
        entities_by_type = {}
        for entity in self.generated_entities.values():
            entity_type = entity.entity_type
            if entity_type not in entities_by_type:
                entities_by_type[entity_type] = []
            entities_by_type[entity_type].append(entity)
        
        # è¾“å‡ºå„ç±»å‹å®ä½“
        for entity_type, entities in entities_by_type.items():
            type_names = {
                'empire': 'AIå¸å›½',
                'fallen_empire': 'å •è½å¸å›½', 
                'species': 'ç§æ—',
                'pre_ftl': 'å‰FTLæ–‡æ˜'
            }
            
            lines.append(f"## {type_names.get(entity_type, entity_type.upper())} ({len(entities)}ä¸ª)")
            lines.append("")
            
            for entity in entities:
                lines.append(f"### {entity.name}")
                lines.append(f"- **å ä½ç¬¦**: [{entity.placeholder_id}]")
                
                if entity.entity_type == 'empire':
                    lines.append(f"- **ç§æ—**: {entity.properties['species']}")
                    lines.append(f"- **ç‰©ç§è‚–åƒ**: {entity.properties['portrait']}")
                    lines.append(f"- **æ€æ½®**: {', '.join(entity.properties['ethics'])}")
                    lines.append(f"- **æ”¿ä½“**: {entity.properties['authority']}")
                    lines.append(f"- **ç‰¹è´¨**: {', '.join(entity.properties['traits'])}")
                    lines.append(f"- **æ€§æ ¼**: {entity.properties['personality']}")
                
                elif entity.entity_type == 'fallen_empire':
                    lines.append(f"- **ç§æ—**: {entity.properties['species']}")
                    lines.append(f"- **ç±»å‹**: {entity.properties['type_name']}")
                    lines.append(f"- **æ€æ½®**: {', '.join(entity.properties['ethics'])}")
                    lines.append(f"- **æ€§æ ¼**: {entity.properties['personality']}")
                
                elif entity.entity_type == 'species':
                    lines.append(f"- **ç‰©ç§è‚–åƒ**: {entity.properties['portrait']}")
                    lines.append(f"- **ç‰¹è´¨**: {', '.join(entity.properties['traits'])}")
                
                lines.append("")
        
        return "\n".join(lines)
    
    def save_chronicle_files(self, final_chronicle: str, entities_settings: str, output_dir: str):
        """
        ä¿å­˜ç¼–å¹´å²å’Œè®¾å®šæ–‡ä»¶
        
        Args:
            final_chronicle: æœ€ç»ˆç¼–å¹´å²å†…å®¹
            entities_settings: å®ä½“è®¾å®šå†…å®¹
            output_dir: è¾“å‡ºç›®å½•
        """
        print(f"\nğŸ’¾ ä¿å­˜æ–‡ä»¶åˆ°ç›®å½•: {output_dir}")
        
        # ä¿å­˜æœ€ç»ˆç¼–å¹´å²
        chronicle_file = os.path.join(output_dir, "ç¾¤æ˜Ÿå¸å›½ç¼–å¹´å².txt")
        with open(chronicle_file, 'w', encoding='utf-8') as f:
            f.write(final_chronicle)
        print(f"âœ… ç¼–å¹´å²å·²ä¿å­˜: {chronicle_file}")
        
        # ä¿å­˜å®ä½“è®¾å®š
        settings_file = os.path.join(output_dir, "åŠ¨æ€ç”Ÿæˆå®ä½“è®¾å®š.md")
        with open(settings_file, 'w', encoding='utf-8') as f:
            f.write(entities_settings)
        print(f"âœ… å®ä½“è®¾å®šå·²ä¿å­˜: {settings_file}")
        
        # ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯
        stats_file = os.path.join(output_dir, "ç”Ÿæˆç»Ÿè®¡.txt")
        self._save_generation_stats(stats_file)
        print(f"âœ… ç”Ÿæˆç»Ÿè®¡å·²ä¿å­˜: {stats_file}")
    
    def _save_generation_stats(self, stats_file: str):
        """ä¿å­˜ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯"""
        stats_lines = []
        stats_lines.append("=" * 40)
        stats_lines.append("ç¾¤æ˜Ÿå¸å›½ç¼–å¹´å²ç”Ÿæˆç»Ÿè®¡")
        stats_lines.append("=" * 40)
        stats_lines.append("")
        stats_lines.append(f"è§£ææ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        stats_lines.append(f"æ€»äº‹ä»¶æ•°: {len(self.timeline_events)}")
        
        # è®¡ç®—å¹´åº¦æ ‡è®°äº‹ä»¶æ•°é‡
        year_marker_count = sum(1 for e in self.timeline_events if e.definition == "timeline_event_year")
        
        if self.include_year_markers:
            stats_lines.append(f"å·²çŸ¥äº‹ä»¶: {sum(1 for e in self.timeline_events if e.definition in self.event_descriptions)}")
            stats_lines.append(f"æœªçŸ¥äº‹ä»¶: {sum(1 for e in self.timeline_events if e.definition not in self.event_descriptions)}")
            stats_lines.append(f"å¹´åº¦æ ‡è®°äº‹ä»¶: {year_marker_count} (å·²åŒ…å«)")
        else:
            filtered_total = len(self.timeline_events) - year_marker_count
            known_events = sum(1 for e in self.timeline_events if e.definition in self.event_descriptions and e.definition != "timeline_event_year")
            unknown_events = sum(1 for e in self.timeline_events if e.definition not in self.event_descriptions)
            
            stats_lines.append(f"å®é™…è¾“å‡ºäº‹ä»¶æ•°: {filtered_total}")
            stats_lines.append(f"å·²çŸ¥äº‹ä»¶: {known_events}")
            stats_lines.append(f"æœªçŸ¥äº‹ä»¶: {unknown_events}")
            stats_lines.append(f"å¹´åº¦æ ‡è®°äº‹ä»¶: {year_marker_count} (å·²è¿‡æ»¤)")
        
        stats_lines.append("")
        stats_lines.append("ç”Ÿæˆå®ä½“ç»Ÿè®¡:")
        for entity_type, count in self.entity_counters.items():
            if count > 0:
                stats_lines.append(f"- {entity_type}: {count}ä¸ª")
        stats_lines.append("")
        
        # æœªçŸ¥äº‹ä»¶åˆ—è¡¨
        unknown_events = [e.definition for e in self.timeline_events if e.definition not in self.event_descriptions]
        if unknown_events:
            stats_lines.append("æœªçŸ¥äº‹ä»¶ä»£ç :")
            for event_code in set(unknown_events):
                count = unknown_events.count(event_code)
                stats_lines.append(f"- {event_code} (å‡ºç°{count}æ¬¡)")
        
        with open(stats_file, 'w', encoding='utf-8') as f:
            f.write("\n".join(stats_lines))
    
    def run(self, save_file_path: str, skip_input: bool = False):
        """
        æ‰§è¡Œå®Œæ•´çš„ç¼–å¹´å²ç”Ÿæˆæµç¨‹
        
        Args:
            save_file_path: å­˜æ¡£æ–‡ä»¶è·¯å¾„
            skip_input: æ˜¯å¦è·³è¿‡ç”¨æˆ·è¾“å…¥ï¼ˆå½“å‘½ä»¤è¡Œå·²æä¾›å¸å›½åç§°æ—¶ï¼‰
        """
        print("ğŸš€ å¼€å§‹æ‰§è¡Œç¾¤æ˜Ÿå¸å›½ç¼–å¹´å²ç”Ÿæˆ...")
        
        # è·å–ç”¨æˆ·è¾“å…¥çš„å¸å›½åç§°ï¼ˆå¦‚æœå°šæœªè®¾ç½®ï¼‰
        if not skip_input and self.player_empire_name == "ç©å®¶å¸å›½":
            print("\n" + "=" * 40)
            print("ğŸ›ï¸  å¸å›½åç§°è®¾ç½®")
            print("=" * 40)
            try:
                user_empire_name = input("è¯·è¾“å…¥æ‚¨çš„å¸å›½åç§°ï¼ˆç›´æ¥æŒ‰å›è½¦ä½¿ç”¨é»˜è®¤åç§°'ç©å®¶å¸å›½'ï¼‰: ")
                self.set_player_empire_name(user_empire_name)
            except KeyboardInterrupt:
                print("\n\nâŒ ç”¨æˆ·å–æ¶ˆæ“ä½œ")
                return
            except EOFError:
                print("âš ï¸  æ£€æµ‹åˆ°éäº¤äº’ç¯å¢ƒï¼Œä½¿ç”¨é»˜è®¤å¸å›½åç§°")
                
            print("=" * 40)
        
        # è·å–ç”¨æˆ·å¯¹å¹´åº¦æ ‡è®°çš„åå¥½è®¾ç½®
        if not skip_input:
            print("\n" + "=" * 40)
            print("ğŸ“… å¹´åº¦æ ‡è®°è®¾ç½®")
            print("=" * 40)
            print("å¹´åº¦æ ‡è®°äº‹ä»¶æ˜¯å½¢å¦‚ '2384.01.01 - å¹´åº¦æ ‡è®°_2384.01.01_æ—¶å…‰èè‹’ï¼Œ2384.01.01å¹´æ‚„ç„¶è€Œè‡³ã€‚' çš„æ¡ç›®")
            try:
                user_choice = input("æ˜¯å¦åŒ…å«å¹´åº¦æ ‡è®°äº‹ä»¶ï¼Ÿ(y/N): ").strip().lower()
                include_markers = user_choice in ['y', 'yes', 'æ˜¯', '1', 'true']
                self.set_year_markers_option(include_markers)
            except KeyboardInterrupt:
                print("\n\nâŒ ç”¨æˆ·å–æ¶ˆæ“ä½œ")
                return
            except EOFError:
                print("âš ï¸  æ£€æµ‹åˆ°éäº¤äº’ç¯å¢ƒï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆåŒ…å«å¹´åº¦æ ‡è®°ï¼‰")
                
            print("=" * 40)
        
        # æ­¥éª¤1: è§£æå­˜æ¡£æ–‡ä»¶
        if not self.parse_save_file(save_file_path):
            print("âŒ å­˜æ¡£æ–‡ä»¶è§£æå¤±è´¥ï¼Œç¨‹åºç»ˆæ­¢")
            return
        
        # æ­¥éª¤2: ç”Ÿæˆåˆç‰ˆç¼–å¹´å²
        print("\nğŸ“ ç”Ÿæˆåˆç‰ˆç¼–å¹´å²...")
        initial_chronicle = self.generate_initial_chronicle()
        
        # æ­¥éª¤3: åŠ¨æ€ç”Ÿæˆå®ä½“å¹¶æ›¿æ¢å ä½ç¬¦
        print("\nğŸ¤– åŠ¨æ€ç”ŸæˆAIå®ä½“...")
        final_chronicle = self.generate_final_chronicle(initial_chronicle)
        
        # æ­¥éª¤4: ç”Ÿæˆå®ä½“è®¾å®šæ–‡ä»¶
        entities_settings = self.generate_entities_settings_file()
        
        # æ­¥éª¤5: ä¿å­˜æ‰€æœ‰æ–‡ä»¶
        output_dir = os.path.dirname(save_file_path)
        self.save_chronicle_files(final_chronicle, entities_settings, output_dir)
        
        print("\nğŸ‰ ç¾¤æ˜Ÿå¸å›½ç¼–å¹´å²ç”Ÿæˆå®Œæˆï¼")
        print(f"ğŸ“ è¾“å‡ºæ–‡ä»¶ä½ç½®: {output_dir}")
        print("ğŸ“š ç”Ÿæˆæ–‡ä»¶:")
        print("  - ç¾¤æ˜Ÿå¸å›½ç¼–å¹´å².txt (æœ€ç»ˆç¼–å¹´å²)")
        print("  - åŠ¨æ€ç”Ÿæˆå®ä½“è®¾å®š.md (AIå¸å›½è®¾å®š)")
        print("  - ç”Ÿæˆç»Ÿè®¡.txt (ç»Ÿè®¡ä¿¡æ¯)")
        print(f"\nğŸŒŸ æ‚¨çš„å¸å›½ '{self.player_empire_name}' çš„ç¼–å¹´å²å·²ç”Ÿæˆå®Œæˆï¼")


def main():
    """ä¸»å‡½æ•°"""
    if len(sys.argv) < 2 or len(sys.argv) > 4:
        print("ä½¿ç”¨æ–¹æ³•: ")
        print("  python stellaris_chronicle_generator.py <å­˜æ¡£æ–‡ä»¶è·¯å¾„>")
        print("  python stellaris_chronicle_generator.py <å­˜æ¡£æ–‡ä»¶è·¯å¾„> <å¸å›½åç§°>")
        print("  python stellaris_chronicle_generator.py <å­˜æ¡£æ–‡ä»¶è·¯å¾„> <å¸å›½åç§°> <æ˜¯å¦åŒ…å«å¹´åº¦æ ‡è®°>")
        print("")
        print("ä¾‹å¦‚: ")
        print("  python stellaris_chronicle_generator.py timeline_events.txt")
        print("  python stellaris_chronicle_generator.py timeline_events.txt æ³°æ‹‰è”é‚¦")
        print("  python stellaris_chronicle_generator.py timeline_events.txt æ³°æ‹‰è”é‚¦ no")
        print("")
        print("å¹´åº¦æ ‡è®°é€‰é¡¹:")
        print("  yes/y/1/true: åŒ…å«å¹´åº¦æ ‡è®°äº‹ä»¶")
        print("  no/n/0/false: ä¸åŒ…å«å¹´åº¦æ ‡è®°äº‹ä»¶")
        sys.exit(1)
    
    save_file_path = sys.argv[1]
    empire_name = sys.argv[2] if len(sys.argv) >= 3 else None
    year_markers_option = sys.argv[3] if len(sys.argv) == 4 else None
    
    if not os.path.exists(save_file_path):
        print(f"é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - {save_file_path}")
        sys.exit(1)
    
    # åˆ›å»ºç”Ÿæˆå™¨
    generator = StellarisChronicleGenerator()
    
    # å¤„ç†å‘½ä»¤è¡Œå‚æ•°
    skip_input = False
    
    # å¦‚æœå‘½ä»¤è¡Œæä¾›äº†å¸å›½åç§°ï¼Œç›´æ¥ä½¿ç”¨
    if empire_name:
        generator.set_player_empire_name(empire_name)
        skip_input = True
    
    # å¦‚æœå‘½ä»¤è¡Œæä¾›äº†å¹´åº¦æ ‡è®°é€‰é¡¹ï¼Œç›´æ¥ä½¿ç”¨
    if year_markers_option:
        include_markers = year_markers_option.lower() in ['yes', 'y', '1', 'true']
        generator.set_year_markers_option(include_markers)
        skip_input = True
    
    if skip_input:
        print("=" * 40)
        # è¿è¡Œç”Ÿæˆå™¨ï¼Œè·³è¿‡äº¤äº’è¾“å…¥
        generator.run(save_file_path, skip_input=True)
    else:
        # è¿è¡Œç”Ÿæˆå™¨ï¼Œéœ€è¦äº¤äº’è¾“å…¥
        generator.run(save_file_path)


if __name__ == "__main__":
    main()